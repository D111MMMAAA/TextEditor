<Window x:Class="TextEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Текстовый редактор с языковым процессором" 
        Height="700" Width="1000" 
        WindowStartupLocation="CenterScreen"
        Drop="Window_Drop" AllowDrop="True"
        Closing="Window_Closing"
        Loaded="Window_Loaded"
        KeyDown="Window_KeyDown">

    <Window.Resources>
        <Style TargetType="Button" x:Key="ToolbarButtonStyle">
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFE0E0E0"/>
                    <Setter Property="Cursor" Value="Hand"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- МЕНЮ -->
        <Menu Grid.Row="0" x:Name="MainMenu" Background="#FFF0F0F0">
            <MenuItem x:Name="FileMenu" Header="_Файл">
                <MenuItem x:Name="NewMenuItem" Header="_Создать" Click="NewFile_Click" InputGestureText="Ctrl+N"/>
                <MenuItem x:Name="OpenMenuItem" Header="_Открыть..." Click="OpenFile_Click" InputGestureText="Ctrl+O"/>
                <MenuItem x:Name="SaveMenuItem" Header="_Сохранить" Click="SaveFile_Click" InputGestureText="Ctrl+S"/>
                <MenuItem x:Name="SaveAsMenuItem" Header="Сохранить _как..." Click="SaveAsFile_Click"/>
                <Separator/>
                <MenuItem x:Name="ExitMenuItem" Header="_Выход" Click="Exit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem x:Name="EditMenu" Header="_Правка">
                <MenuItem x:Name="UndoMenuItem" Header="_Отменить" Click="Undo_Click" InputGestureText="Ctrl+Z"/>
                <MenuItem x:Name="RedoMenuItem" Header="_Повторить" Click="Redo_Click" InputGestureText="Ctrl+Y"/>
                <Separator/>
                <MenuItem x:Name="CutMenuItem" Header="_Вырезать" Click="Cut_Click" InputGestureText="Ctrl+X"/>
                <MenuItem x:Name="CopyMenuItem" Header="К_опировать" Click="Copy_Click" InputGestureText="Ctrl+C"/>
                <MenuItem x:Name="PasteMenuItem" Header="_Вставить" Click="Paste_Click" InputGestureText="Ctrl+V"/>
                <MenuItem x:Name="DeleteMenuItem" Header="_Удалить" Click="Delete_Click" InputGestureText="Del"/>
                <Separator/>
                <MenuItem x:Name="SelectAllMenuItem" Header="Выделить _все" Click="SelectAll_Click" InputGestureText="Ctrl+A"/>
            </MenuItem>
            <MenuItem x:Name="ViewMenu" Header="_Вид">
                <MenuItem x:Name="IncreaseFontMenuItem" Header="_Увеличить текст" Click="IncreaseFontSize_Click" InputGestureText="Ctrl+Plus"/>
                <MenuItem x:Name="DecreaseFontMenuItem" Header="_Уменьшить текст" Click="DecreaseFontSize_Click" InputGestureText="Ctrl+Minus"/>
                <MenuItem x:Name="ResetFontMenuItem" Header="Сбросить _масштаб" Click="ResetFontSize_Click" InputGestureText="Ctrl+0"/>
                <Separator/>
                <MenuItem x:Name="ThemeMenu" Header="_Тема">
                    <MenuItem x:Name="LightThemeMenuItem" Header="Светлая" IsCheckable="True" IsChecked="True" Click="LightTheme_Click"/>
                    <MenuItem x:Name="DarkThemeMenuItem" Header="Темная" IsCheckable="True" Click="DarkTheme_Click"/>
                </MenuItem>
                <Separator/>
                <MenuItem x:Name="LanguageMenu" Header="_Язык интерфейса">
                    <MenuItem x:Name="RussianLanguageMenuItem" Header="Русский" IsCheckable="True" IsChecked="True" Click="SetRussianLanguage_Click"/>
                    <MenuItem x:Name="EnglishLanguageMenuItem" Header="English" IsCheckable="True" Click="SetEnglishLanguage_Click"/>
                </MenuItem>
            </MenuItem>
            <MenuItem x:Name="HelpMenu" Header="_Справка">
                <MenuItem x:Name="HelpMenuItem" Header="_Справка" Click="Help_Click" InputGestureText="F1"/>
                <Separator/>
                <MenuItem x:Name="AboutMenuItem" Header="_О программе" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <!-- ПАНЕЛЬ ИНСТРУМЕНТОВ -->
        <ToolBarTray Grid.Row="1" x:Name="MainToolBarTray" Background="#FFF5F5F5">
            <ToolBar>
                <!-- НОВЫЙ ФАЙЛ -->
                <Button x:Name="NewButton" Click="NewFile_Click" ToolTip="Создать (Ctrl+N)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Rectangle Width="20" Height="20" Canvas.Left="2" Canvas.Top="2" 
                                      Stroke="#FF333333" StrokeThickness="1.5" Fill="White" RadiusX="2" RadiusY="2"/>
                            <Line X1="12" Y1="5" X2="12" Y2="19" Stroke="#FF333333" StrokeThickness="1.5"/>
                            <Line X1="5" Y1="12" X2="19" Y2="12" Stroke="#FF333333" StrokeThickness="1.5"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- ОТКРЫТЬ -->
                <Button x:Name="OpenButton" Click="OpenFile_Click" ToolTip="Открыть (Ctrl+O)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Path Stroke="#FF333333" StrokeThickness="1.5" Fill="#FFFFD700">
                                <Path.Data>
                                    <GeometryGroup>
                                        <RectangleGeometry Rect="2,6,20,14" RadiusX="2" RadiusY="2"/>
                                        <RectangleGeometry Rect="4,2,16,4" RadiusX="1" RadiusY="1"/>
                                    </GeometryGroup>
                                </Path.Data>
                            </Path>
                            <Ellipse Width="6" Height="6" Canvas.Left="14" Canvas.Top="12" 
                                    Stroke="#FF333333" StrokeThickness="1.5" Fill="White"/>
                            <Line X1="19" Y1="17" X2="22" Y2="20" Stroke="#FF333333" StrokeThickness="2"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- СОХРАНИТЬ -->
                <Button x:Name="SaveButton" Click="SaveFile_Click" ToolTip="Сохранить (Ctrl+S)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Rectangle Width="18" Height="18" Canvas.Left="3" Canvas.Top="3" 
                                      Stroke="#FF333333" StrokeThickness="1.5" Fill="#FFE0E0E0" RadiusX="2" RadiusY="2"/>
                            <Rectangle Width="8" Height="6" Canvas.Left="8" Canvas.Top="10" 
                                      Stroke="#FF333333" StrokeThickness="1" Fill="#FF333333"/>
                            <Rectangle Width="10" Height="2" Canvas.Left="7" Canvas.Top="5" 
                                      Fill="#FF333333"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <Separator/>

                <!-- ВЫРЕЗАТЬ -->
                <Button x:Name="CutButton" Click="Cut_Click" ToolTip="Вырезать (Ctrl+X)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Ellipse Width="6" Height="6" Canvas.Left="3" Canvas.Top="3" 
                                    Stroke="#FF333333" StrokeThickness="1.5" Fill="White"/>
                            <Ellipse Width="6" Height="6" Canvas.Left="15" Canvas.Top="15" 
                                    Stroke="#FF333333" StrokeThickness="1.5" Fill="White"/>
                            <Line X1="7" Y1="7" X2="17" Y2="17" Stroke="#FF333333" StrokeThickness="1.5"/>
                            <Line X1="9" Y1="7" X2="3" Y2="13" Stroke="#FF333333" StrokeThickness="1.5"/>
                            <Line X1="17" Y1="15" X2="21" Y2="11" Stroke="#FF333333" StrokeThickness="1.5"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- КОПИРОВАТЬ -->
                <Button x:Name="CopyButton" Click="Copy_Click" ToolTip="Копировать (Ctrl+C)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Rectangle Width="12" Height="14" Canvas.Left="6" Canvas.Top="4" 
                                      Stroke="#FF333333" StrokeThickness="1.5" Fill="White" RadiusX="2" RadiusY="2"/>
                            <Rectangle Width="12" Height="14" Canvas.Left="10" Canvas.Top="8" 
                                      Stroke="#FF333333" StrokeThickness="1.5" Fill="#FFE0E0E0" RadiusX="2" RadiusY="2"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- ВСТАВИТЬ -->
                <Button x:Name="PasteButton" Click="Paste_Click" ToolTip="Вставить (Ctrl+V)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Rectangle Width="14" Height="16" Canvas.Left="5" Canvas.Top="4" 
                                      Stroke="#FF333333" StrokeThickness="1.5" Fill="White" RadiusX="2" RadiusY="2"/>
                            <Path Stroke="#FF333333" StrokeThickness="1.5" Fill="#FF333333">
                                <Path.Data>
                                    <GeometryGroup>
                                        <RectangleGeometry Rect="8,2,8,3"/>
                                        <RectangleGeometry Rect="9,3,6,2"/>
                                    </GeometryGroup>
                                </Path.Data>
                            </Path>
                            <Line X1="8" Y1="12" X2="16" Y2="12" Stroke="#FF333333" StrokeThickness="1"/>
                            <Line X1="8" Y1="15" X2="16" Y2="15" Stroke="#FF333333" StrokeThickness="1"/>
                            <Line X1="8" Y1="18" X2="13" Y2="18" Stroke="#FF333333" StrokeThickness="1"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <Separator/>

                <!-- ОТМЕНИТЬ -->
                <Button x:Name="UndoButton" Click="Undo_Click" ToolTip="Отменить (Ctrl+Z)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Path Stroke="#FF333333" StrokeThickness="2" Fill="Transparent">
                                <Path.Data>
                                    <PathGeometry>
                                        <PathFigure StartPoint="16,8">
                                            <ArcSegment Point="8,8" Size="6,6" RotationAngle="0" 
                                                       IsLargeArc="True" SweepDirection="Counterclockwise"/>
                                            <LineSegment Point="12,12"/>
                                        </PathFigure>
                                    </PathGeometry>
                                </Path.Data>
                            </Path>
                            <Polygon Points="8,12 12,8 12,16" Fill="#FF333333"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <!-- ПОВТОРИТЬ -->
                <Button x:Name="RedoButton" Click="Redo_Click" ToolTip="Повторить (Ctrl+Y)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Path Stroke="#FF333333" StrokeThickness="2" Fill="Transparent">
                                <Path.Data>
                                    <PathGeometry>
                                        <PathFigure StartPoint="8,8">
                                            <ArcSegment Point="16,8" Size="6,6" RotationAngle="0" 
                                                       IsLargeArc="True" SweepDirection="Clockwise"/>
                                            <LineSegment Point="12,12"/>
                                        </PathFigure>
                                    </PathGeometry>
                                </Path.Data>
                            </Path>
                            <Polygon Points="16,12 12,8 12,16" Fill="#FF333333"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <Separator/>

                <!-- УДАЛИТЬ -->
                <Button x:Name="DeleteButton" Click="Delete_Click" ToolTip="Удалить (Del)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Rectangle Width="16" Height="4" Canvas.Left="4" Canvas.Top="10" 
                                      Fill="#FF333333" RadiusX="2" RadiusY="2"/>
                            <Line X1="8" Y1="6" X2="8" Y2="18" Stroke="#FF333333" StrokeThickness="1.5"/>
                            <Line X1="12" Y1="6" X2="12" Y2="18" Stroke="#FF333333" StrokeThickness="1.5"/>
                            <Line X1="16" Y1="6" X2="16" Y2="18" Stroke="#FF333333" StrokeThickness="1.5"/>
                        </Canvas>
                    </Viewbox>
                </Button>

                <Separator/>

                <!-- СПРАВКА -->
                <Button x:Name="HelpButton" Click="Help_Click" ToolTip="Справка (F1)" Style="{StaticResource ToolbarButtonStyle}">
                    <Viewbox Stretch="Uniform" Width="20" Height="20">
                        <Canvas Width="24" Height="24">
                            <Ellipse Width="18" Height="18" Canvas.Left="3" Canvas.Top="3" 
                                    Stroke="#FF333333" StrokeThickness="1.5" Fill="White"/>
                            <TextBlock Canvas.Left="9" Canvas.Top="4" Text="?" FontSize="16" 
                                      FontWeight="Bold" Foreground="#FF333333"/>
                        </Canvas>
                    </Viewbox>
                </Button>
            </ToolBar>

            <!-- Панель размера шрифта -->
            <ToolBar>
                <Label x:Name="SizeLabel" Content="Размер:" VerticalAlignment="Center" Margin="5,0"/>
                <ComboBox x:Name="FontSizeCombo" SelectedIndex="4" Width="70" SelectionChanged="FontSizeCombo_SelectionChanged">
                    <ComboBoxItem Content="8"/>
                    <ComboBoxItem Content="9"/>
                    <ComboBoxItem Content="10"/>
                    <ComboBoxItem Content="11"/>
                    <ComboBoxItem Content="12"/>
                    <ComboBoxItem Content="14"/>
                    <ComboBoxItem Content="16"/>
                    <ComboBoxItem Content="18"/>
                    <ComboBoxItem Content="20"/>
                    <ComboBoxItem Content="24"/>
                    <ComboBoxItem Content="28"/>
                    <ComboBoxItem Content="32"/>
                    <ComboBoxItem Content="36"/>
                    <ComboBoxItem Content="48"/>
                </ComboBox>
                <Button x:Name="ZoomInButton" Click="IncreaseFontSize_Click" ToolTip="Увеличить" Width="24" Height="24" Margin="2">
                    <TextBlock Text="+" FontSize="16" FontWeight="Bold"/>
                </Button>
                <Button x:Name="ZoomOutButton" Click="DecreaseFontSize_Click" ToolTip="Уменьшить" Width="24" Height="24" Margin="2">
                    <TextBlock Text="-" FontSize="16" FontWeight="Bold"/>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <!-- ОБЛАСТЬ РЕДАКТИРОВАНИЯ -->
        <TabControl x:Name="EditorTabControl" Grid.Row="2" Margin="5">
            <TabItem x:Name="FirstTab" Header="Новый документ 1" IsSelected="True">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Нумерация строк -->
                    <ScrollViewer Grid.Column="0" 
                                  x:Name="LineNumbersScrollViewer"
                                  HorizontalScrollBarVisibility="Disabled" 
                                  VerticalScrollBarVisibility="Auto" 
                                  Background="#FFF0F0F0"
                                  VerticalAlignment="Stretch">
                        <ItemsControl x:Name="LineNumbers" 
                                     FontFamily="Consolas" 
                                     FontSize="12" 
                                     Background="#FFF0F0F0" 
                                     Padding="5,2,5,2">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" 
                                               Margin="0,0,5,0"
                                               Foreground="#FF666666"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- Текстовый редактор -->
                    <RichTextBox x:Name="EditorTextBox" 
                                Grid.Column="1" 
                                VerticalScrollBarVisibility="Auto" 
                                HorizontalScrollBarVisibility="Auto"
                                FontFamily="Consolas" 
                                FontSize="12"
                                SpellCheck.IsEnabled="True"
                                BorderThickness="1" 
                                BorderBrush="#FFCCCCCC"
                                TextChanged="EditorTextBox_TextChanged"
                                PreviewKeyDown="EditorTextBox_PreviewKeyDown"
                                ScrollViewer.ScrollChanged="EditorTextBox_ScrollChanged"/>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- РАЗДЕЛИТЕЛЬ -->
        <GridSplitter Grid.Row="3" x:Name="MainSplitter" Height="5" HorizontalAlignment="Stretch" 
                     Background="#FFCCCCCC" ResizeDirection="Rows"/>

        <!-- ОБЛАСТЬ ВЫВОДА -->
        <TabControl x:Name="OutputTabControl" Grid.Row="4" Margin="5">
            <TabItem x:Name="ResultsTab" Header="Результаты анализа">
                <ListView x:Name="ResultsListView" 
                         ItemsSource="{Binding Results}"
                         SelectionChanged="ResultsListView_SelectionChanged"
                         Background="White">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Строка" Width="60" DisplayMemberBinding="{Binding Line}"/>
                            <GridViewColumn Header="Тип" Width="100" DisplayMemberBinding="{Binding Type}"/>
                            <GridViewColumn Header="Сообщение" Width="400" DisplayMemberBinding="{Binding Message}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>
            <TabItem x:Name="OutputTab" Header="Вывод">
                <TextBox x:Name="OutputTextBox" 
                        IsReadOnly="True"
                        TextWrapping="Wrap"
                        VerticalScrollBarVisibility="Auto"
                        FontFamily="Consolas" FontSize="12"
                        Background="White"
                        BorderThickness="1" BorderBrush="#FFCCCCCC"
                        Padding="5"/>
            </TabItem>
            <TabItem x:Name="ErrorsTab" Header="Ошибки">
                <ListView x:Name="ErrorsListView" 
                         ItemsSource="{Binding Errors}"
                         Background="White">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Строка" Width="60" DisplayMemberBinding="{Binding Line}"/>
                            <GridViewColumn Header="Столбец" Width="70" DisplayMemberBinding="{Binding Column}"/>
                            <GridViewColumn Header="Ошибка" Width="400" DisplayMemberBinding="{Binding Message}"/>
                        </GridView>
                    </ListView.View>
                </ListView>
            </TabItem>
        </TabControl>

        <!-- СТРОКА СОСТОЯНИЯ -->
        <StatusBar Grid.Row="5" x:Name="MainStatusBar" Background="#FFF0F0F0">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Готов" MinWidth="200"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="LineColumnText" Text="Стр: 1 Стлб: 1" MinWidth="120"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="EncodingText" Text="UTF-8" MinWidth="60"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="ZoomText" Text="100%" MinWidth="50"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>